
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Turret vs Zombies</title>

<style>
:root {
  --green:#0a7a0a;
  --bg:#111;
  --panel:#222;
  --gold:#f5c542;
}

* { box-sizing: border-box; }

body {
  margin:0;
  background:var(--bg);
  color:#fff;
  font-family:system-ui, sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  height:100vh;
}

/* TOP */
#topBar {
  width:100%;
  padding:8px 12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

#stats { display:flex; gap:16px; }
#wave { font-weight:bold; }

#shopBtn {
  background:var(--gold);
  border:none;
  border-radius:6px;
  padding:6px 10px;
  font-weight:bold;
}

/* BOARD */
#boardWrap {
  position: relative;
}

#board {
  display:grid;
  grid-template-columns:repeat(5,56px);
  grid-template-rows:repeat(10,56px);
  gap:4px;
  padding:6px;
  background:#222;
  border-radius:12px;
}

.cell {
  background:var(--green);
  border-radius:6px;
}

.turret{background:black!important;}
.bullet{background:#8b4513!important;}
.basic{background:#2466ff!important;}
.armored{background:orange!important;}
.heavy{background:#999!important;}
.danger{background:#b00000!important;}

/* GAME OVER OVERLAY */
#gameOver {
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.8);
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  gap:14px;
  z-index:20;
}

#gameOver h1 {
  color:red;
  margin:0;
}

#retryBtn {
  padding:8px 18px;
  font-size:18px;
  border:none;
  border-radius:8px;
  background:var(--gold);
  font-weight:bold;
}

/* CONTROLS */
#controls {
  display:flex;
  gap:12px;
  margin-top:10px;
}

.btn {
  width:72px;
  height:48px;
  font-size:20px;
  border:none;
  border-radius:8px;
  background:#333;
  color:white;
}

#shootBtn {
  position:relative;
  overflow:hidden;
}

#cooldownBar {
  position:absolute;
  bottom:0;
  left:0;
  height:4px;
  background:var(--gold);
  width:0%;
}

/* SHOP */
#shop {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:50;
}

#shopBox {
  background:#222;
  width:90%;
  max-width:380px;
  padding:14px;
  border-radius:14px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.shopRow {
  display:grid;
  grid-template-columns:1fr auto;
  gap:8px;
  background:#2b2b2b;
  padding:8px;
  border-radius:8px;
}

.shopBtn {
  background:var(--gold);
  border:none;
  border-radius:6px;
  padding:6px 10px;
  font-weight:bold;
}

.shopBtn:disabled {
  background:#555;
  color:#aaa;
}
</style>
</head>

<body>

<div id="topBar">
  <button id="shopBtn">Shop</button>
  <div id="stats">
    <div id="kills">Kills: 0</div>
    <div id="coins">Coins: 0</div>
    <div id="wave">Wave 1</div>
  </div>
</div>

<div id="boardWrap">
  <div id="board"></div>

  <div id="gameOver">
    <h1>GAME OVER</h1>
    <button id="retryBtn">Retry</button>
  </div>
</div>

<div id="controls">
  <button class="btn" id="leftBtn">‚¨ÖÔ∏è</button>
  <button class="btn" id="shootBtn">
    üî´
    <div id="cooldownBar"></div>
  </button>
  <button class="btn" id="rightBtn">‚û°Ô∏è</button>
</div>

<div id="shop">
  <div id="shopBox">
    <h3>Upgrades</h3>
    <div class="shopRow"><div>Cooldown</div><button id="cdBtn" class="shopBtn"></button></div>
    <div class="shopRow"><div>Bullet Speed</div><button id="spdBtn" class="shopBtn"></button></div>
    <div class="shopRow"><div>Burst Shots</div><button id="burstBtn" class="shopBtn"></button></div>
    <div class="shopRow"><div>Coin Gain</div><button id="coinBtn" class="shopBtn"></button></div>
    <div class="shopRow"><div>Pierce Chance</div><button id="pierceBtn" class="shopBtn"></button></div>
    <button class="btn" onclick="toggleShop()">Close</button>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const COLS=5, ROWS=10;
const LOOP=50;

/* ================= GRID ================= */
const board=document.getElementById("board");
const cells=[];
for(let r=0;r<ROWS;r++){
  cells[r]=[];
  for(let c=0;c<COLS;c++){
    const d=document.createElement("div");
    d.className="cell";
    board.appendChild(d);
    cells[r][c]=d;
  }
}

/* ================= GLOBAL STATE ================= */
let turretCol, bullets, zombies;
let kills, coins, wave;
let running, gameOver;

let shootCooldown, bulletSpeed, burst, burstLeft;
let coinMul, pierceChance;
let spawnDelay, armoredChance, heavyChance;
let canShoot;

/* ================= RESET ================= */
function resetGame(){
  turretCol=2;
  bullets=[];
  zombies=[];
  kills=0;
  coins=0;
  wave=1;

  shootCooldown=3750;
  bulletSpeed=0.25;
  burst=1;
  burstLeft=1;
  coinMul=1;
  pierceChance=0;

  spawnDelay=4000;
  armoredChance=0.25;
  heavyChance=0.10;

  canShoot=true;
  running=true;
  gameOver=false;

  document.getElementById("gameOver").style.display="none";
  refreshShop();
}

/* ================= SPAWN ================= */
function spawnZombie(){
  let roll=Math.random();
  let z={type:"basic",hp:1};

  if(kills>=100 && roll<heavyChance){
    z={type:"heavy",hp:3};
    heavyChance=Math.min(.20,heavyChance+.001);
  } else if(kills>=25 && roll<armoredChance){
    z={type:"armored",hp:2};
    armoredChance=Math.min(.50,armoredChance+.001);
  }

  z.col=Math.floor(Math.random()*COLS);
  z.y=0;
  zombies.push(z);
}

function spawnLoop(){
  if(gameOver) return;
  spawnZombie();
  if(kills/10>wave){ wave++; spawnDelay=Math.max(800,spawnDelay-300); }
  setTimeout(spawnLoop,spawnDelay);
}

/* ================= SHOOT ================= */
const shootBtn=document.getElementById("shootBtn");
const cooldownBar=document.getElementById("cooldownBar");

shootBtn.onclick=()=>{
  if(!running||!canShoot) return;
  bullets.push({y:ROWS-1-0.01,col:turretCol});
  burstLeft--;
  if(burstLeft<=0){
    canShoot=false;
    let start=Date.now();
    let t=setInterval(()=>{
      let p=(Date.now()-start)/shootCooldown;
      cooldownBar.style.width=Math.min(100,p*100)+"%";
      if(p>=1){
        clearInterval(t);
        cooldownBar.style.width="0%";
        burstLeft=burst;
        canShoot=true;
      }
    },16);
  }
};

/* ================= UPDATE ================= */
function update(){
  bullets.forEach(b=>b.y-=bulletSpeed);
  zombies.forEach(z=>z.y+=0.04);

  for(let i=bullets.length-1;i>=0;i--){
    for(let j=zombies.length-1;j>=0;j--){
      const b=bullets[i],z=zombies[j];
      if(Math.abs(b.y-z.y)<0.4 && b.col===z.col){
        if(Math.random()>pierceChance) bullets.splice(i,1);
        z.hp--;
        if(z.hp<=0){
          zombies.splice(j,1);
          kills++;
          let drop=25+Math.random()*5;
          if(z.type==="armored") drop=50+Math.random()*10;
          if(z.type==="heavy") drop=90+Math.random()*20;
          coins+=Math.floor(drop*coinMul);
        } else {
          z.type=z.type==="heavy"?"armored":"basic";
        }
        return;
      }
    }
    if(bullets[i]&&bullets[i].y<0) bullets.splice(i,1);
  }

  zombies.forEach(z=>{ if(z.y>=ROWS-2) endGame(); });
}

/* ================= DRAW ================= */
function draw(){
  cells.flat().forEach(c=>c.className="cell");
  for(let c=0;c<COLS;c++) cells[ROWS-2][c].classList.add("danger");

  bullets.forEach(b=>{
    const r=Math.floor(b.y);
    if(cells[r]) cells[r][b.col].classList.add("bullet");
  });

  zombies.forEach(z=>{
    const r=Math.floor(z.y);
    if(cells[r]) cells[r][z.col].classList.add(z.type);
  });

  cells[ROWS-1][turretCol].classList.add("turret");

  killsEl.textContent="Kills: "+kills;
  coinsEl.textContent="Coins: "+coins;
  waveEl.textContent="Wave "+wave;
}

/* ================= LOOP ================= */
setInterval(()=>{ if(running&&!gameOver){update();draw();}},LOOP);

/* ================= END ================= */
function endGame(){
  gameOver=true;
  running=false;
  document.getElementById("gameOver").style.display="flex";
}

/* ================= CONTROLS ================= */
leftBtn.onclick=()=>{if(running&&turretCol>0)turretCol--;};
rightBtn.onclick=()=>{if(running&&turretCol<COLS-1)turretCol++;};

/* ================= SHOP ================= */
function toggleShop(){
  shop.style.display=shop.style.display==="flex"?"none":"flex";
  running=shop.style.display!=="flex";
}
shopBtn.onclick=toggleShop;

/* ================= UPGRADES ================= */
const upgrades={
  cooldown:{vals:[3250,2500,2000,1250,500],costs:[300,1e3,5e3,25e3,1e5],lvl:0},
  speed:{vals:[0.35,0.5,0.8,1.2,1.6],costs:[200,500,2500,1e4,25e3],lvl:0},
  burst:{vals:[2,3,4],costs:[1e3,1e4,1e5],lvl:0},
  coins:{vals:[1.5,2,3,4],costs:[750,4e3,25e3,75e3],lvl:0},
  pierce:{vals:[0.1,0.2,0.35],costs:[2e3,1e4,5e4],lvl:0}
};

function bind(btn,key,apply){
  btn.onclick=()=>{
    const u=upgrades[key];
    if(u.lvl>=u.vals.length||coins<u.costs[u.lvl]) return;
    coins-=u.costs[u.lvl];
    apply(u.vals[u.lvl]);
    u.lvl++;
    refreshShop();
  };
}

function refreshShop(){
  [["cooldown",cdBtn],["speed",spdBtn],["burst",burstBtn],["coins",coinBtn],["pierce",pierceBtn]]
  .forEach(([k,b])=>{
    const u=upgrades[k];
    if(u.lvl>=u.vals.length){ b.textContent="MAX"; b.disabled=true; }
    else b.textContent=u.costs[u.lvl];
  });
}

bind(cdBtn,"cooldown",v=>shootCooldown=v);
bind(spdBtn,"speed",v=>bulletSpeed=v);
bind(burstBtn,"burst",v=>{burst=v;burstLeft=v;});
bind(coinBtn,"coins",v=>coinMul=v);
bind(pierceBtn,"pierce",v=>pierceChance=v);

/* ================= START ================= */
const killsEl=document.getElementById("kills");
const coinsEl=document.getElementById("coins");
const waveEl=document.getElementById("wave");

retryBtn.onclick=()=>{ resetGame(); spawnLoop(); };

resetGame();
spawnLoop();
draw();
</script>
</body>
</html>
