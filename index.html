<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Turret vs Zombies</title>

<style> 
body {
  margin: 0;
  background: #0f0f0f;
  font-family: system-ui, sans-serif;
  color: white;
  display: flex;
  justify-content: center;
  height: 100vh;
}

#game {
  width: 420px;
  display: flex;
  flex-direction: column;
  align-items: center;
}


#topBar { 
   width: 100%; 
   padding: 8px; 
   display: flex; 
   flex-direction: column; 
   gap: 6px; 
}

#stats {
  display: flex;
  justify-content: space-between;
  font-size: 14px;
}

#cooldownBar {
  display: grid;
  grid-auto-flow: column;
  gap: 4px;
  height: 8px;
}

.cooldownSeg {
  background: #333;
  border-radius: 6px;
  overflow: hidden;
}

.cooldownSegFill {
  height: 100%;
  width: 0%;
  background: gold;
  transition: width 0.08s linear;
}


#boardWrapper {
  position: relative;
}

#board {
  display: grid;
  grid-template-columns: repeat(5, 56px);
  grid-template-rows: repeat(10, 56px);
  gap: 0;
  padding: 6px;
  background: #222;
  border-radius: 12px
}

.cell {
  background: #0a7a0a;
  border-radius: 0;      
  box-shadow: inset 0 0 0 1px rgba(0,0,0,0.15);
}


.danger {
  position: relative;
  background: #0a7a0a !important; 
}

.danger::after {
  content: "";
  position: absolute;
  left: 0px;
  right: 0px;
  top: 50%;
  height: 4px;
  background: red;
  border-radius: 0px;
  transform: translateY(-50%);
}


#entities {
  position: absolute;
  inset: 6px;
  pointer-events: none;
}

.entity {
  position: absolute;
  width: 56px;
  height: 56px;
  display: flex;
  align-items: center;
  justify-content: center;
}


.turret {
  width: 38px;
  height: 38px;
  background: black;
  border-radius: 6px;
}

.bullet {
  width: 16px;
  height: 16px;
  background: #8b4513;
  border-radius: 50%;
  box-shadow: 0 0 6px rgba(139,69,19,.8);
}

.zombie {
  width: 38px;
  height: 38px;
  border-radius: 6px;
  border: 2px solid rgba(0,0,0,.35);
}
.basic { background:#2c6bff; }
.armored { background:orange; }
.heavy { background:#777; }


#controls {
  margin-top: 10px;
  display: flex;
  gap: 10px;
}
#controls button {
  width: 70px;
  height: 48px;
  font-size: 20px;
  border-radius: 10px;
  border: none;
  background: #333;
  color: white;
}
#shop {
  margin-top: 10px;
  margin-left: auto;
  margin-right: 0px;
  display: flex;
  gap: 10px;
}
#shop button {
  width: 70px;
  height: 48px;
  font-size: 20px;
  border-radius: 10px;
  border: none;
  background: #333;
  color: white;
}

.overlay {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.75);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 10;
}

.panel {
  background: #1b1b1b;
  padding: 16px;
  border-radius: 12px;
  width: 320px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.upgradeRow {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 8px;
  background: #2a2a2a;
  padding: 8px;
  border-radius: 8px;
}

.upgradeRow button {
  background: gold;
  border: none;
  border-radius: 6px;
  padding: 6px 10px;
  font-weight: bold;
}
.upgradeRow button:disabled {
  background:#555;
  color:#aaa;
}

</style>
</head>

<body>
<audio id="upgrade" src="Upgrade.wav" preload="auto"></audio>
<audio id="shot" src="GunShot.wav" preload="auto"></audio>
<audio id="shoot" src="shoot.wav" preload="auto"></audio>
<div id="game">

  <div id="topBar">
    <div id="stats">
      <div id="kills">Kills: 0</div>
      <div id="wave">Wave: 1</div>
      <div id="coins">Coins: 0</div>
    </div>
    <div id="cooldownBar"></div>
  </div>
<div id="shop"> <button onclick="openUpgrades()">ðŸ›’</button></div>
  <div id="boardWrapper">
    <div id="board"></div>
    <div id="entities"></div>

    <div id="gameOver" class="overlay">
      <div class="panel">
        <h2 style="color:red;margin:0">GAME OVER</h2>
        <button onclick="restart()">Retry</button>
      </div>
    </div>
  </div>

  <div id="controls">
    <button onclick="move(-1)">Â«</button>
    <button onclick="shoot()">+</button>
    <button onclick="move(1)">Â»</button>
  </div>
</div>

<div id="upgradeOverlay" class="overlay">
  <div class="panel">
    <h3>Upgrades</h3>
    <div id="upgradeList"></div>
    <button onclick="closeUpgrades()">Close</button>
  </div>
</div>

<script>
/* ================= CONSTANTS ================= */
const COLS=5, ROWS=10, TILE=56, LOOP=50;

/* ================= GRID ================= */
const board=document.getElementById("board");
for(let r=0;r<ROWS;r++){
  for(let c=0;c<COLS;c++){
    const d=document.createElement("div");
    d.className="cell";
    if(r===ROWS-2) d.classList.add("danger");
    board.appendChild(d);
  }
}

/* ================= STATE ================= */
let turretCol, bullets, zombies;
let kills, coins, running, over;

let shootCooldown, bulletSpeed, burst, burstLeft;
let knockback, coinMult;

let coolingDown=false;
let cooldownStart=0;
let spawnDelay, armoredChance, heavyChance;

/* ================= UPGRADES ================= */
const upgrades=[
  {name:"Cooldown", vals:[3250,2500,2000,1250,500], costs:[300,1e3,5e3,25e3,1e5], apply:v=>shootCooldown=v},
  {name:"Bullet Speed", vals:[0.35,0.5,0.8,1.2,1.6], costs:[200,500,2500,1e4,25e3], apply:v=>bulletSpeed=v},
  {name:"Burst", vals:[2,3,4], costs:[1e3,1e4,1e5], apply:v=>{burst=v;burstLeft=v}},
  {name:"Coin Gain", vals:[1.5,2,3,4], costs:[750,4e3,25e3,75e3], apply:v=>coinMult=v},
  {name:"Knockback", vals:[1,2,3], costs:[2e3,1e4,5e4], apply:v=>knockback=v}
];
upgrades.forEach(u=>u.lvl=0);

/* ================== AUDIO ================== */
function PlayUpgrade() {
  const a = document.getElementById("upgrade");
  a.currentTime = 0;
  a.play();
}
function PlayShot() {
  const a = document.getElementById("shot");
  a.currentTime = 0;
  a.play();
}
function PlayShoot() {
  const a = document.getElementById("shoot");
  a.currentTime = 0;
  a.play();
}
/* ================= RESET ================= */
function restart(){
  turretCol=2;
  bullets=[];
  zombies=[];
  kills=0;
  coins=0;

  shootCooldown=3750;
  bulletSpeed=0.25;
  burst=1;
  burstLeft=1;
  knockback=0;
  coinMult=1;

  coolingDown=false;
  cooldownStart=0;

  spawnDelay=4000;
  armoredChance=.25;
  heavyChance=.1;

  upgrades.forEach(u=>u.lvl=0);

  running=true;
  over=false;
  document.getElementById("gameOver").style.display="none";
  refreshUpgrades();
}
restart();

/* ================= INPUT ================= */
function move(d){
  if(!running) return;
  turretCol=Math.max(0,Math.min(COLS-1,turretCol+d));
}

function shoot(){
  if(!running||burstLeft<=0||coolingDown)  return;
  
  bullets.push({y:ROWS-1, prevY:ROWS-1, col:turretCol});
  PlayShot();
  burstLeft--;
  

  if(burstLeft===0){
    coolingDown=true;
    cooldownStart=Date.now();
  }
}

/* ================= COOLDOWN ================= */
function updateCooldown(){
  if(!coolingDown) return;

  const elapsed=Date.now()-cooldownStart;
  const perSeg=shootCooldown/burst;
  burstLeft=Math.min(burst,Math.floor(elapsed/perSeg));

  if(burstLeft>=burst){
    burstLeft=burst;
    coolingDown=false;
  }
}

function drawCooldown(){
  const bar=document.getElementById("cooldownBar");
  bar.innerHTML="";
  const elapsed=Date.now()-cooldownStart;
  const perSeg=shootCooldown/burst;

  for(let i=0;i<burst;i++){
    const seg=document.createElement("div");
    seg.className="cooldownSeg";
    const fill=document.createElement("div");
    fill.className="cooldownSegFill";

    if(!coolingDown){
      fill.style.width=i<burstLeft?"100%":"0%";
    }else{
      const prog=Math.min(1,Math.max(0,(elapsed-i*perSeg)/perSeg));
      fill.style.width=(prog*100)+"%";
    }

    seg.appendChild(fill);
    bar.appendChild(seg);
  }
}

/* ================= SPAWN ================= */
function spawnZombie(){
  let z={type:"basic",hp:1};
  const r=Math.random();

  if(kills>=150 && r<heavyChance){
    z={type:"heavy",hp:3};
    heavyChance=Math.min(.2,heavyChance+.001);
  }else if(kills>=50 && r<armoredChance){
    z={type:"armored",hp:2};
    armoredChance=Math.min(.5,armoredChance+.001);
  }

  z.col=Math.floor(Math.random()*COLS);
  z.y=0;
  zombies.push(z);
}

(function spawnLoop(){
  if(!over){
    spawnZombie();
    spawnDelay=Math.max(800,spawnDelay-10);
  }
  setTimeout(spawnLoop,spawnDelay);
})();

/* ================= UPDATE ================= */
function update(){
  updateCooldown();

  zombies.forEach(z=>z.y+=0.04);
  bullets.forEach(b=>{b.prevY=b.y; b.y-=bulletSpeed;});

  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i];
    for(let j=zombies.length-1;j>=0;j--){
      const z=zombies[j];
      if(b.col===z.col && b.prevY>=z.y && b.y<=z.y+.5){
        PlayShoot();
        bullets.splice(i,1);
        z.hp--;
        if(knockback) z.y=Math.max(0,z.y-knockback);

        if(z.hp<=0){
          zombies.splice(j,1);
          kills++;
          let drop=50+Math.random()*10;
          if(z.type==="armored") drop=90+Math.random()*20;
          if(z.type==="heavy") drop=150+Math.random()*30;
          coins+=Math.floor(drop*coinMult);
        }else{
          z.type=z.type==="heavy"?"armored":"basic";
        }
        break;
      }
    }
    if(bullets[i]&&b.y<0) bullets.splice(i,1);
  }

  zombies.forEach(z=>{ if(z.y>=ROWS-2) endGame(); });
}

/* ================= DRAW ================= */
function draw(){
  const ent=document.getElementById("entities");
  ent.innerHTML="";

  bullets.forEach(b=>{
    const d=document.createElement("div");
    d.className="entity";
    d.style.transform=`translate(${b.col*TILE}px,${b.y*TILE}px)`;
    d.innerHTML='<div class="bullet"></div>';
    ent.appendChild(d);
  });

  zombies.forEach(z=>{
    const d=document.createElement("div");
    d.className="entity";
    d.style.transform=`translate(${z.col*TILE}px,${z.y*TILE}px)`;
    d.innerHTML=`<div class="zombie ${z.type}"></div>`;
    ent.appendChild(d);
  });

  const t=document.createElement("div");
  t.className="entity";
  t.style.transform=`translate(${turretCol*TILE}px,${(ROWS-1)*TILE}px)`;
  t.innerHTML='<div class="turret"></div>';
  ent.appendChild(t);

  document.getElementById("kills").textContent=`Kills: ${kills}`;
  document.getElementById("coins").textContent=`Coins: ${coins}`;
  document.getElementById("wave").textContent=`Wave: ${Math.floor(kills/25)+1}`;

  drawCooldown();
}

/* ================= LOOP ================= */
setInterval(()=>{ if(running&&!over){update();draw();}},LOOP);

/* ================= UI ================= */
function endGame(){
  running=false;
  over=true;
  document.getElementById("gameOver").style.display="flex";
}

function openUpgrades(){
  running=false;
  document.getElementById("upgradeOverlay").style.display="flex";
}

function closeUpgrades(){
  running=true;
  document.getElementById("upgradeOverlay").style.display="none";
}

function refreshUpgrades(){
  const list=document.getElementById("upgradeList");
  list.innerHTML="";
  upgrades.forEach(u=>{
    const row=document.createElement("div");
    row.className="upgradeRow";

    const info=document.createElement("div");
    const cur=u.lvl?u.vals[u.lvl-1]:"Base";
    const next=u.lvl<u.vals.length?u.vals[u.lvl]:"MAX";
    info.innerHTML=`<b>${u.name}</b><br>Current: ${cur}<br>Next: ${next}`;

    const btn=document.createElement("button");
    if(u.lvl>=u.vals.length){
      btn.textContent="MAX";
      btn.disabled=true;
    }else{
      btn.textContent=u.costs[u.lvl];
      btn.disabled=coins<u.costs[u.lvl];
      btn.onclick=()=>{
        coins-=u.costs[u.lvl];
        u.apply(u.vals[u.lvl]);
        u.lvl++;
        refreshUpgrades();
        PlayUpgrade();
      };
    }

    row.append(info,btn);
    list.appendChild(row);
  });
}
setInterval(refreshUpgrades,300);
</script>

</body>
</html>

