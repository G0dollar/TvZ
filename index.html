
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Turret vs Zombies: Definitive Edition</title>

<style>
/* ================= ROOT ================= */
:root {
  --gold:#ffd700;
  --bg:#0a0a0c;
  --cell:#1a2e1a;
  --danger:#2e1a1a;
}

/* ================= BASE ================= */
body {
  margin:0;
  background:radial-gradient(circle at center,#1b1b25,#050505);
  font-family:'Segoe UI',system-ui,sans-serif;
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  overflow:hidden;
}

#game {
  width:420px;
  display:flex;
  flex-direction:column;
  align-items:center;
  position:relative;
}

/* ================= TOP BAR ================= */
#topBar {
  width:100%;
  padding:12px;
  background:rgba(0,0,0,.6);
  border-radius:12px;
  margin-bottom:10px;
  border:1px solid #333;
}

#stats {
  display:grid;
  grid-template-columns:1fr 1fr 1fr auto;
  gap:10px;
  font-weight:bold;
  font-size:14px;
  color:var(--gold);
}

/* ================= COOLDOWN ================= */
#cooldownBar {
  display:grid;
  grid-auto-flow:column;
  gap:4px;
  height:10px;
  margin-top:10px;
}

.cooldownSeg {
  background:#222;
  border-radius:5px;
  overflow:hidden;
  border:1px solid #333;
}

.cooldownSegFill {
  height:100%;
  width:0%;
  background:linear-gradient(to right,#ffae00,var(--gold));
  transition:width .1s linear;
}

/* ================= BOARD ================= */
#boardWrapper { position:relative; }

#board {
  display:grid;
  grid-template-columns:repeat(5,56px);
  grid-template-rows:repeat(10,56px);
  background:#111;
  border-radius:12px;
  padding:6px;
  border:4px solid #333;
  box-shadow:0 20px 50px rgba(0,0,0,.8);
}

.cell {
  background:var(--cell);
  box-shadow:inset 0 0 15px rgba(0,0,0,.5);
}

.danger {
  background:var(--danger);
  position:relative;
  animation:dangerPulse 1.5s infinite;
}

.danger::after {
  content:"";
  position:absolute;
  left:0; right:0; top:50%;
  height:3px;
  background:#ff4444;
  box-shadow:0 0 10px red;
  transform:translateY(-50%);
}

/* ================= ENTITIES ================= */
#entities {
  position:absolute;
  inset:6px;
  pointer-events:none;
}

.entity {
  position:absolute;
  width:56px;
  height:56px;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* ================= TURRET ================= */
.turret {
  width:40px;
  height:40px;
  background:linear-gradient(135deg,#333,#111);
  border-radius:50%;
  border:2px solid #444;
  position:relative;
}

.turret.fire { animation:recoil .12s; }

.nozzle {
  position:absolute;
  width:12px;
  height:20px;
  background:#222;
  top:-15px;
  left:50%;
  transform:translateX(-50%);
  border-radius:3px;
  border:1px solid #444;
}

/* ================= BULLETS ================= */
.bullet {
  width:14px;
  height:14px;
  background:white;
  border-radius:50%;
  box-shadow:0 0 10px white,0 0 20px var(--gold);
  animation:bulletPulse .4s infinite alternate;
}

.enemyBullet {
  background:#f00;
  box-shadow:0 0 10px red;
}

/* ================= ZOMBIES ================= */
.zombiebody {
  width:40px;
  height:40px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  border:2px solid rgba(0,0,0,.5);
  animation:zombieWalk .6s infinite alternate;
}

.zombie {
  width:22px;
  height:22px;
  border-radius:50%;
}

.basic { background:#4ecdc4; }
.fast { background:#ff0054; }
.armored { background:#f77f00; border:2px solid white; }
.heavy { background:#444; border:2px solid #aaa; }

.hit { animation:hitFlash .15s; }
.dead { animation:death .3s forwards; }

/* ================= BOSS BAR ================= */
#bossBarContainer {
  display:none;
  width:100%;
  height:8px;
  background:#200;
  border-radius:4px;
  margin-bottom:10px;
  overflow:hidden;
  border:1px solid #500;
}

#bossBarFill {
  width:100%;
  height:100%;
  background:linear-gradient(to right,#ff0000,#900);
}

/* ================= CONTROLS ================= */
#controls {
  margin-top:15px;
  display:flex;
  gap:10px;
  width:100%;
}

button {
  background:#222;
  color:white;
  border:1px solid #444;
  border-radius:12px;
  cursor:pointer;
  transition:.2s;
  font-weight:bold;
}

button:hover { filter:brightness(1.2); }
button:active { transform:scale(.95); }

#controls button {
  height:55px;
  font-size:24px;
  flex:1;
}

/* ================= OVERLAYS ================= */
.overlay {
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:100;
  backdrop-filter:blur(5px);
}

.panel {
  background:#1a1a1c;
  padding:25px;
  border-radius:20px;
  width:320px;
  border:1px solid #333;
  animation:scaleIn .3s ease;
}
/* ================= IMPROVED SHOP UI ================= */
#upgradeList {
  display: flex;
  flex-direction: column;
  gap: 12px;
  max-height: 400px;
  overflow-y: auto;
  padding-right: 5px;
}

.upgradeRow {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #252528;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid #333;
}

.upgrade-info {
  flex-grow: 1;
}

.upgrade-name {
  font-weight: bold;
  font-size: 14px;
  margin-bottom: 4px;
}

.lvl-pips {
  display: flex;
  gap: 3px;
}

.pip {
  width: 8px;
  height: 4px;
  background: #444;
  border-radius: 2px;
}

.pip.filled {
  background: var(--gold);
  box-shadow: 0 0 5px var(--gold);
}

.buy-btn {
  min-width: 80px;
  height: 35px !important;
  font-size: 14px !important;
  margin-left: 10px;
  background: #2e7d32 !important; /* Green for buying */
  border: none !important;
}

.buy-btn:disabled {
  background: #333 !important;
  color: #777 !important;
  cursor: not-allowed;
}
  
/* ================= ANIMATIONS ================= */
@keyframes recoil { 50%{transform:scale(.9)} }
@keyframes bulletPulse { to{transform:scale(1.25)} }
@keyframes zombieWalk { to{transform:translateY(3px)} }
@keyframes hitFlash { from{filter:brightness(4)}to{filter:brightness(1)} }
@keyframes death { to{opacity:0;transform:scale(.3)} }
@keyframes dangerPulse { 50%{filter:brightness(1.4)} }
@keyframes scaleIn { from{transform:scale(.7);opacity:0} }
</style>
</head>

<body>

<!-- ================= START SCREEN ================= -->
<div id="startScreen" class="overlay" style="display:flex;">
  <div class="panel" style="text-align:center;">
    <button class="info-toggle" onclick="toggleInfo()">i</button>
    <h1 style="color:var(--gold);margin:0 0 10px;">TURRET DEFENSE</h1>
    <p style="opacity:.7;">Protect the perimeter.</p>

    <button onclick="startGame()"
      style="width:100%;height:60px;background:var(--gold);color:black;font-size:20px;">
      START GAME
    </button>

    <div id="infoBox" style="display:none;margin-top:15px;">
      <strong>HOW TO PLAY:</strong><br>
      â€¢ â—€ â–¶ Move turret<br>
      â€¢ FIRE shoots bullets<br>
      â€¢ âŸ³ reloads burst ammo<br>
      â€¢ Donâ€™t let zombies reach the red line<br>
      â€¢ ðŸ›’ upgrades your turret
    </div>
  </div>
</div>

<!-- ================= GAME ================= -->
<div id="game">

  <!-- TOP BAR -->
  <div id="topBar">
    <div id="stats">
      <div id="kills">KILLS: 0</div>
      <div id="wave">WAVE: 1</div>
      <div id="coins">COINS: 100</div>
      <button id="shopBtn" onclick="openUpgrades()">ðŸ›’</button>
    </div>
    <div id="cooldownBar"></div>
  </div>

  <!-- BOSS BAR -->
  <div id="bossBarContainer">
    <div id="bossBarFill"></div>
  </div>

  <!-- BOARD -->
  <div id="boardWrapper">
    <div id="board"></div>
    <div id="entities"></div>

    <!-- GAME OVER -->
    <div id="gameOver" class="overlay">
      <div class="panel" style="text-align:center;">
        <h2 style="color:#ff4444;margin-top:0;">GAME OVER</h2>
        <p id="finalScore"></p>
        <button onclick="resetGame()"
          style="width:100%;height:50px;background:white;color:black;">
          TRY AGAIN
        </button>
      </div>
    </div>
  </div>

  <!-- CONTROLS -->
  <div id="controls">
    <button onclick="move(-1)">â—€</button>
    <button onclick="shoot()"
      style="background:var(--gold);color:black;flex:2;">
      FIRE
    </button>
    <button onclick="move(1)">â–¶</button>
    <button onclick="reload()">âŸ³</button>
  </div>
</div>

<!-- ================= UPGRADES ================= -->
<div id="upgradeOverlay" class="overlay">
  <div class="panel">
    <h3 style="margin-top:0;color:var(--gold);">SHOP / UPGRADES</h3>
    <div id="upgradeList"></div>
    <button onclick="closeUpgrades()"
      style="width:100%;margin-top:15px;height:40px;">
      BACK TO GAME
    </button>
  </div>
</div>

<script>
/* ================= GAME CONSTANTS ================= */
const COLS = 5;
const ROWS = 10;
const TILE = 56;
const LOOP = 50;
const WAVE_DURATION = 20000;

/* ================= AUDIO SETUP ================= */
// These will look for the files in the same folder as your HTML
const upgradeSfx = new Audio('Upgrade.wav');
const gunshotSfx = new Audio('GunShot.wav');
const hitSfx = new Audio('Shoot.wav'); // Per your request for hitting zombies

/* ================= GAME STATE ================= */
let turretCol = 2;
let bullets = [];
let zombies = [];
let enemyBullets = [];

let kills = 0;
let coins = 100;
let wave = 1;

let running = false;
let over = false;
let spawningEnabled = true;

let shootCooldown = 3750;
let bulletSpeed = 0.3;
let burst = 1;
let burstLeft = 1;
let coolingDown = false;
let cooldownStart = 0;

let spawnDelay = 4500;
let spawnTimeout = null;
let waveTimer = 0;

let coinMult = 1;
let knockback = 0;

/* ================= UPGRADES ================= */
const upgrades = [
  { name:"Fire Rate", vals:[3250,2500,1800,1000,650,250], costs:[200,500,1000,7500,10000,50000], lvl:0, apply:v=>shootCooldown=v },
  { name:"Bullet Speed", vals:[0.4,0.7,1.2,1.8,2.5], costs:[200,600,3000,10000,50000], lvl:0, apply:v=>bulletSpeed=v },
  { name:"Burst Ammo", vals:[2,3,4,5], costs:[800,4000,15000,60000], lvl:0, apply:v=>{ burst=v; burstLeft=v; coolingDown=false; } },
  { name:"Coin Gain", vals:[1.5,2,3,5,7], costs:[500,2500,7500,15000,60000], lvl:0, apply:v=>coinMult=v },
  { name:"Knockback", vals:[0.2,0.5,0.8,1.2], costs:[1200,6000,25000,750000], lvl:0, apply:v=>knockback=v }
];

/* ================= BOARD SETUP ================= */
const board = document.getElementById("board");
for(let r=0;r<ROWS;r++){
  for(let c=0;c<COLS;c++){
    const cell = document.createElement("div");
    cell.className = "cell" + (r===ROWS-2?" danger":"");
    board.appendChild(cell);
  }
}

/* ================= UI HELPERS ================= */
function toggleInfo(){
  const box = document.getElementById("infoBox");
  box.style.display = box.style.display==="block"?"none":"block";
}

/* ================= GAME FLOW ================= */
function startGame(){
  document.getElementById("startScreen").style.display="none";
  resetGame();
}

function resetGame(){
  clearTimeout(spawnTimeout);
  turretCol = 2;
  bullets = [];
  zombies = [];
  enemyBullets = [];
  kills = 0;
  coins = 0;
  wave = 1;
  waveTimer = 0;
  spawnDelay = 4500;

  burstLeft = burst;
  coolingDown = false;

  over = false;
  running = true;
  spawningEnabled = true;

  document.getElementById("gameOver").style.display="none";
  document.getElementById("bossBarContainer").style.display="none";

  spawnZombie();
}

/* ================= MOVEMENT ================= */
function move(dir){
  if(!running) return;
  turretCol = Math.max(0,Math.min(COLS-1,turretCol+dir));
}

/* ================= SHOOTING ================= */
function shoot(){
  if(!running || coolingDown || burstLeft<=0) return;

  // PLAY GUNSHOT
  gunshotSfx.currentTime = 0; 
  gunshotSfx.play();

  bullets.push({
    col: turretCol,
    y: ROWS-1,
    prevY: ROWS-1
  });

  burstLeft--;

  const bw = document.getElementById("boardWrapper");
  bw.classList.remove("shake");
  void bw.offsetWidth;
  bw.classList.add("shake");

  if(burstLeft===0){
    coolingDown = true;
    cooldownStart = Date.now();
  }

  drawCooldown();
}

function getBossShootPattern() {
  return Math.random() < 0.5 ? [0, 2, 4] : [1, 3];
}
  
function reload(){
  if(!running || coolingDown || burstLeft===burst) return;
  burstLeft = 0;
  coolingDown = true;
  cooldownStart = Date.now();
}

/* ================= SPAWNING ================= */
function spawnZombie(){
  if(over || !running || !spawningEnabled) return;

  const minibossAlive = zombies.some(z=>z.type==="miniboss");
  if(!minibossAlive){
    let z = { type:"basic", hp:1, speed:0.04, drop:[40,60], isHit:false };
    const r = Math.random();

    if(kills>=100 && r<0.03) z={ type:"heavy", hp:4, speed:0.02, drop:[150,200] };
    else if(kills>=50 && r<0.08) z={ type:"armored", hp:2, speed:0.04, drop:[80,110] };
    else if(kills>=20 && r<0.12) z={ type:"fast", hp:1, speed:0.08, drop:[50,70] };

    z.col = Math.floor(Math.random()*COLS);
    z.y = -1;
    zombies.push(z);
  }

  spawnTimeout = setTimeout(spawnZombie, spawnDelay);
}



/* ================= UPDATE LOOP ================= */
function update(){
  if(coolingDown){
    const elapsed = Date.now() - cooldownStart;
    const per = shootCooldown / burst;
    burstLeft = Math.floor(elapsed / per);
    if(burstLeft >= burst){
   function spawnMiniBoss() {
  // KILL ALL CURRENT ZOMBIES ON LAWN
  zombies = []; 
  
  // Optional: Add a small visual flair or message here
  console.log("BOSS WAVE: Lawns Cleared!");

  zombies.push({
    type: "miniboss",
    hp: (wave * 1), // Increased HP for boss feel
    maxHp: (wave * 1),
    speed: 0.015,
    y: -1,
    cols: [1, 2, 3],
    drop: [1000, 1500],
    shootTimer: 0,
    shootPattern: getBossShootPattern(),
    isHit: false
  });

  document.getElementById("bossBarContainer").style.display = "block";
  document.getElementById("bossBarFill").style.width = "100%";
   }   burstLeft = burst;
      coolingDown = false;
    }
    drawCooldown();
  }

  waveTimer += LOOP;
  if(waveTimer >= WAVE_DURATION){
    wave++;
    waveTimer = 0;
    spawnDelay = Math.max(800, spawnDelay-400);
    if(wave % 5 === 0) spawnMiniBoss();
  }

  zombies.forEach(z=>{
    z.y += z.speed;
    if (z.type === "miniboss") {
      z.shootTimer += LOOP;
      if (z.shootTimer > 2500) {
        z.shootTimer = 0;
        z.shootPattern.forEach(col => {
          enemyBullets.push({ col, y: z.y + 1 });
        });
        z.shootPattern = getBossShootPattern();
      }
    }
    if(z.y >= ROWS-2) endGame();
  });

  bullets.forEach(b=>{
    b.prevY = b.y;
    b.y -= bulletSpeed;
  });

  enemyBullets.forEach(b=>{
    b.y += 0.15;
    if(Math.abs(b.y-(ROWS-1))<0.2 && b.col===turretCol){
      endGame();
    }
  });

  /* === COLLISIONS === */
  for(let i=bullets.length-1;i>=0;i--){
    for(let j=zombies.length-1;j>=0;j--){
      const b = bullets[i];
      const z = zombies[j];
      const hitCol = z.cols ? z.cols.includes(b.col) : b.col===z.col;

      if(hitCol && b.y<=z.y+0.6 && b.prevY>=z.y){
        // PLAY HIT SOUND
        hitSfx.currentTime = 0;
        hitSfx.play();

        z.hp--;
        z.isHit = true;
        z.y = Math.max(-1, z.y-knockback);
        bullets.splice(i,1);

        if(z.type==="miniboss"){
          document.getElementById("bossBarFill").style.width = (z.hp/z.maxHp*100)+"%";
        }

        if(z.hp<=0){
          coins += Math.floor((Math.random()*(z.drop[1]-z.drop[0])+z.drop[0]) * coinMult);
          if(z.type==="miniboss"){
            document.getElementById("bossBarContainer").style.display="none";
          }
          zombies.splice(j,1);
          kills++;
        }
        break;
      }
    }
  }
}

/* ================= RENDER ================= */
function draw(){
  const container = document.getElementById("entities");
  container.innerHTML = "";

  bullets.forEach(b=>renderAt(b.col,b.y,'<div class="bullet"></div>'));
  enemyBullets.forEach(b=>renderAt(b.col,b.y,'<div class="bullet enemyBullet"></div>'));

  zombies.forEach(z=>{
    const hit = z.isHit?" hit":"";
    if(z.type==="miniboss"){
      z.cols.forEach(c=>{
        renderAt(c,z.y,
          `<div class="zombiebody${hit}" style="background:#500;border-color:gold">
             <div class="zombie heavy"></div>
           </div>`
        );
      });
    }else{
      renderAt(z.col,z.y,
        `<div class="zombiebody${hit}">
           <div class="zombie ${z.type}"></div>
         </div>`
      );
    }
    z.isHit = false;
  });

  renderAt(turretCol,ROWS-1,
    `<div class="turret ${burstLeft>0?'fire':''}">
       <div class="nozzle"></div>
     </div>`
  );

  document.getElementById("kills").textContent = `KILLS: ${kills}`;
  document.getElementById("coins").textContent = `COINS: ${coins}`;
  document.getElementById("wave").textContent = `WAVE: ${wave}`;
}

/* ================= HELPERS ================= */
function renderAt(c,y,html){
  const d = document.createElement("div");
  d.className="entity";
  d.style.transform=`translate(${c*TILE}px,${y*TILE}px)`;
  d.innerHTML=html;
  document.getElementById("entities").appendChild(d);
}

function drawCooldown(){
  const bar = document.getElementById("cooldownBar");
  bar.innerHTML="";
  for(let i=0;i<burst;i++){
    const seg = document.createElement("div");
    seg.className="cooldownSeg";
    const fill = document.createElement("div");
    fill.className="cooldownSegFill";

    if(!coolingDown){
      fill.style.width = i<burstLeft?"100%":"0%";
    }else{
      const per = shootCooldown/burst;
      fill.style.width =
        Math.min(100,(Date.now()-cooldownStart-i*per)/per*100)+"%";
    }

    seg.appendChild(fill);
    bar.appendChild(seg);
  }
}

/* ================= END / SHOP ================= */
function endGame(){
  running=false;
  over=true;
  spawningEnabled=false;
  clearTimeout(spawnTimeout);
  document.getElementById("gameOver").style.display="flex";
  document.getElementById("finalScore").textContent = `Kills: ${kills} | Wave: ${wave}`;
}

function openUpgrades(){
  running=false;
  spawningEnabled=false;
  clearTimeout(spawnTimeout);
  refreshUpgrades();
  document.getElementById("upgradeOverlay").style.display="flex";
}

function closeUpgrades(){
  document.getElementById("upgradeOverlay").style.display="none";
  running=true;
  spawningEnabled=true;
  spawnZombie();
}

/* ================= UPGRADES UI ================= */
function refreshUpgrades() {
  const list = document.getElementById("upgradeList");
  list.innerHTML = "";

  upgrades.forEach(u => {
    const cost = u.costs[u.lvl];
    const isMax = u.lvl >= u.vals.length;
    
    // Create Row Container
    const row = document.createElement("div");
    row.className = "upgradeRow";

    // Create Level Pips
    let pipsHtml = "";
    for(let i=0; i < u.vals.length; i++) {
      pipsHtml += `<div class="pip ${i < u.lvl ? 'filled' : ''}"></div>`;
    }

    row.innerHTML = `
      <div class="upgrade-info">
        <div class="upgrade-name">${u.name}</div>
        <div class="lvl-pips">${pipsHtml}</div>
      </div>
    `;

    // Create Button
    const btn = document.createElement("button");
    btn.className = "buy-btn";
    btn.innerHTML = isMax ? "MAXED" : `ðŸª™ ${cost}`;
    btn.disabled = isMax || coins < cost;
    
    btn.onclick = () => {
      upgradeSfx.currentTime = 0;
      upgradeSfx.play();
      coins -= cost;
      u.apply(u.vals[u.lvl]);
      u.lvl++;
      refreshUpgrades();
      document.getElementById("coins").textContent = `COINS: ${coins}`;
    };

    row.appendChild(btn);
    list.appendChild(row);
  });
}
/* ================= MAIN LOOP ================= */
setInterval(()=>{
  if(running && !over){
    update();
    draw();
  }
}, LOOP);
</script>

</body>
</html>

